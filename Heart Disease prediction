# Import necessary libraries
import pandas as pd
from sklearn.model_selection import train_test_split
from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import classification_report, accuracy_score


# Load the dataset
df = pd.read_csv(r"heart prediction.csv")
from tkinter import messagebox
import tkinter as tk
from sklearn.model_selection import train_test_split
from sklearn.linear_model import LogisticRegression
from sklearn.preprocessing import StandardScaler
from sklearn.pipeline import Pipeline
import pandas as pd
from sklearn.metrics import accuracy_score, precision_score, recall_score, f1_score

# Load the dataset
data = r"heart prediction.csv"
df = pd.read_csv(data)

# Separate features and target
X = df.drop('target', axis=1)
y = df['target']

# Split the data
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

# Define the preprocessing and model pipeline
pipeline = Pipeline([
    ('scaler', StandardScaler()),
    ('classifier', LogisticRegression())
])

# Fit the model
pipeline.fit(X_train, y_train)

# Evaluate the model
y_pred = pipeline.predict(X_test)
accuracy = accuracy_score(y_test, y_pred)
precision = precision_score(y_test, y_pred)
recall = recall_score(y_test, y_pred)
f1 = f1_score(y_test, y_pred)

# Create the GUI
def predict():
    try:
        # Gather input data
        user_data = [
            int(age_var.get()),
            int(sex_var.get()),
            int(cp_var.get()),
            int(trestbps_var.get()),
            int(chol_var.get()),
            int(fbs_var.get()),
            int(restecg_var.get()),
            int(thalach_var.get()),
            int(exang_var.get()),
            float(oldpeak_var.get()),
            int(slope_var.get()),
            int(ca_var.get()),
            int(thal_var.get())
        ]
        user_data = [user_data]

        # Predict using the pipeline
        prediction = pipeline.predict(user_data)
        if prediction[0] == 1:
            result = "The person is likely to have heart disease."
        else:
            result = "The person is unlikely to have heart disease."
        
        messagebox.showinfo("Prediction Result", result)
    except ValueError:
        messagebox.showerror("Input Error", "Please enter valid input values.")

# Initialize tkinter window
root = tk.Tk()
root.title("Heart Disease Prediction")

# Input fields
tk.Label(root, text="Age").grid(row=0, column=0)
age_var = tk.StringVar()
tk.Entry(root, textvariable=age_var).grid(row=0, column=1)

tk.Label(root, text="Sex (1=Male, 0=Female)").grid(row=1, column=0)
sex_var = tk.StringVar()
tk.Entry(root, textvariable=sex_var).grid(row=1, column=1)

tk.Label(root, text="Chest Pain Type (0-3)").grid(row=2, column=0)
cp_var = tk.StringVar()
tk.Entry(root, textvariable=cp_var).grid(row=2, column=1)

tk.Label(root, text="Resting Blood Pressure").grid(row=3, column=0)
trestbps_var = tk.StringVar()
tk.Entry(root, textvariable=trestbps_var).grid(row=3, column=1)

tk.Label(root, text="Cholesterol").grid(row=4, column=0)
chol_var = tk.StringVar()
tk.Entry(root, textvariable=chol_var).grid(row=4, column=1)

tk.Label(root, text="Fasting Blood Sugar (1=True, 0=False)").grid(row=5, column=0)
fbs_var = tk.StringVar()
tk.Entry(root, textvariable=fbs_var).grid(row=5, column=1)

tk.Label(root, text="Resting ECG Results (0-2)").grid(row=6, column=0)
restecg_var = tk.StringVar()
tk.Entry(root, textvariable=restecg_var).grid(row=6, column=1)

tk.Label(root, text="Max Heart Rate Achieved").grid(row=7, column=0)
thalach_var = tk.StringVar()
tk.Entry(root, textvariable=thalach_var).grid(row=7, column=1)

tk.Label(root, text="Exercise Induced Angina (1=Yes, 0=No)").grid(row=8, column=0)
exang_var = tk.StringVar()
tk.Entry(root, textvariable=exang_var).grid(row=8, column=1)

tk.Label(root, text="ST Depression").grid(row=9, column=0)
oldpeak_var = tk.StringVar()
tk.Entry(root, textvariable=oldpeak_var).grid(row=9, column=1)

tk.Label(root, text="Slope of ST Segment (0-2)").grid(row=10, column=0)
slope_var = tk.StringVar()
tk.Entry(root, textvariable=slope_var).grid(row=10, column=1)

tk.Label(root, text="Number of Major Vessels (0-3)").grid(row=11, column=0)
ca_var = tk.StringVar()
tk.Entry(root, textvariable=ca_var).grid(row=11, column=1)

tk.Label(root, text="Thalassemia (1-3)").grid(row=12, column=0)
thal_var = tk.StringVar()
tk.Entry(root, textvariable=thal_var).grid(row=12, column=1)

# Predict button
tk.Button(root, text="Predict", command=predict).grid(row=13, column=0, columnspan=2)

# Run the GUI
root.mainloop()

# Preprocessing (assuming no missing values)
X = df.drop("target", axis=1)
y = df["target"]

# Split data into train and test sets
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

# Initialize and train the Random Forest model
clf = RandomForestClassifier(n_estimators=100, random_state=42)
clf.fit(X_train, y_train)


# Make predictions
y_pred = clf.predict(X_test)

# Evaluate the model
print(f"Accuracy: {accuracy_score(y_test, y_pred)}")
print(classification_report(y_test, y_pred))
# Function to get user input and predict heart disease
def predict_heart_disease():
    # Asking for user input for each feature
    user_data = {
        'age': int(input("Enter age: ")),
        'sex': int(input("Enter sex (1 = male, 0 = female): ")),
        'cp': int(input("Enter chest pain type (0-3): ")),
        'trestbps': int(input("Enter resting blood pressure (in mm Hg): ")),
        'chol': int(input("Enter serum cholesterol (in mg/dl): ")),
        'fbs': int(input("Enter fasting blood sugar > 120 mg/dl (1 = true, 0 = false): ")),
        'restecg': int(input("Enter resting electrocardiographic results (0-2): ")),
        'thalach': int(input("Enter maximum heart rate achieved: ")),
        'exang': int(input("Enter exercise-induced angina (1 = yes, 0 = no): ")),
        'oldpeak': float(input("Enter ST depression induced by exercise relative to rest: ")),
        'slope': int(input("Enter the slope of the peak exercise ST segment (0-2): ")),
        'ca': int(input("Enter number of major vessels (0-3) colored by fluoroscopy: ")),
        'thal': int(input("Enter thalassemia (1 = normal, 2 = fixed defect, 3 = reversible defect): "))
    }
    
    # Convert user data to a dataframe
    user_df = pd.DataFrame([user_data])
    
    # Use the trained model to make a prediction
    prediction = clf.predict(user_df)
    
    # Output the result
    if prediction[0] == 1:
        print("The model predicts that the patient has heart disease.")
    else:
        print("The model predicts that the patient does NOT have heart disease.")

# Example call to the function (commented out because we can't use input() here
 
# Call the function to test
predict_heart_disease()